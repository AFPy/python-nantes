<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Écrire du code vraiment Pythonic !</title>

		<meta name="description" content="">
		<meta name="author" content="Alex Garel">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- Personal CSS -->
		<link rel="stylesheet" href="pres.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

<body>

<div class="reveal">

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">
    <section>
        <h1>Écrire du code vraiment Pythonic !</h1>
        <div class="fragment roll-in" data-fragment-index="1">
        <pre class="fragment shrink" data-fragment-index="2"><code class="python">
&gt;&gt;&gt; import this
        </code></pre>
        </div>
        
        <pre class="fragment roll-in" data-fragment-index="2"><code class="python">
          Readability counts.
        </code></pre>
        <p>
            Par Alex Garel pour le Nantes Python Meetup #4
        </p>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
if this == other:
  return True
else:
  return False
        </code></pre>
      </section>
      <section>
        <h2>Le vrai de vrai</h2>
        <p>
            La valeur du test est un booléen, il suffit de le renvoyer !
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            return this == other
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
a,b=23, 12


for x  in range( 12 ) :
    process(x,a = "This is a bit long",
        b = i)
value = theBigObject_on_steroids.theProperty_with_a_long_name.Thelong_method(another_long_indentifier*New_object()).am_i_still_in_screen()
        </code></pre>
      </section>
      <section>
        <h2>Pep8</h2>
        <p>
            Un standard qui veut aider à la lecture du code entre développeurs.
            <a href="https://flake8.readthedocs.org">flake8</a> est ton ami.
        </p>
        <p>
            Si une communauté à d'autres normes,
            suivez les normes de cette communauté dans vos contributions.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
a, b = 23, 12

for x in range(12):
    process(
        x, a="This is a bit long", b=i)

value = (the_big_object_on_steroids
    .the_property_with_a_long_name
    .the_long_method(
        another_long_indentifier * NewObject())
    .am_i_still_in_screen())
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
if len(my_list) == 0:
  print("Oh Gosh, this is empty !")
if len(your_list) > 0:
  print("Gimme some !")
        </code></pre>
      </section>
      <section>
        <h2>Le vrai du faux</h2>
        <p>
            Pas besoin de tester la longueur pour savoir qu'une liste est vide.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
if not my_list:
  print("Oh Gosh, this is empty !")
if your_list:
  print("Gimme some !")
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
def is_empty(a_list):
    return a_list
        </code></pre>
      </section>
      <section>
        <h2>Le vrai du faux</h2>
        <p>
            Si une fonction doit renvoyer un booléen, faites le,
            <code>bool</code> est là pour ça
        </p>
        <p>
            <blockquote>
                Soyez tolérant dans ce que vous acceptez, exigeant dans ce que vous donnez.
            </blockquote>
            <span class="sign">d’après <a href="http://www.postel.org/postel.html">Jon Postel</a></span>
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
def is_empty(a_list):
    return bool(a_list)
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
# adding value to a query string
# we need to escape the '&amp;'
query_string_list = []
if isinstance(value, str):
    try:
        param_value = value.replace('&', '%26')
    except AttributeError:
        param_value = value
    query_string_list.append('%s=%s' % (param, param_value))
elif isinstance(value, list):
    for subvalue in value:
        try:
            param_value = subvalue.replace('&', '%26')
        except AttributeError:
            param_value = subvalue
        query_string_list.append('%s=%s' % (param, param_value))
        </code></pre>
      </section>
      <section>
        <h2>Je ne veux voir qu'une tête !</h2>
        <p>
            Avant de traiter, normaliser les entrées évite de dupliquer le code
            et permet de simplifier sa compréhension.
        </p>
        <p>
        <blockquote>
            Special cases aren't special enough <br>to break the rules
        </blockquote>
        <span class="sign">zen of python #8</span>
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
# adding value to a query string
# we need to escape the '&amp;'
query_string_list = []
for param, value in params.items():
    if not isinstance(value, list):
        value = [value]
    for subvalue in value:
        param_value = str(subvalue).replace('&', '%26')
        query_string_list.append('%s=%s' % (param, param_value))
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
# swap x and y
temp = y
y = x
x = y
        </code></pre>
      </section>
      <section>
        <h2>Échange rapide</h2>
        <p>
            En python on peut directement affecter une valeur a un tuple.
            On appelle ça <em>unpacking</em> (dépaquetage ?)".
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
x, y = y, x
        </code></pre>
      </section>
            <section>
        <h2>En profondeur</h2>
        <pre><code class="python">
            circle = (2.0, (1.0, 1.0))
            r, (x, y) = circle
        </code></pre>
        <pre><code class="python">
import math

def distance((x0, y0), (x1, y1)):
    return math.sqrt((x1 - x0)**2 + (y1 - y0)**2)

point1 = (0.0, 0.0)
point2 = (1.0, 1.0)
distance(point1, point2)
        </code></pre>
        <p>
          <blockquote>
            Although practicality beats purity.
          </blockquote>
          <span class="sign">zen of python #9</span>
        </p>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
even_squares = []
for n in range(20):
  if n % 2 == 0:
      even_squares.append(n ** 2)
        </code></pre>
      </section>
      <section>
        <h2>Se montrer <em>Compréhensif</em></h2>
        <p>
            Pour une itération simple on peut utiliser les <em>list comprehension</em>.
        </p>
        <p>
            <blockquote>
                la syntaxe de certains langages de programmation permet de définir
                des listes en compréhension,
                c'est-à-dire des listes dont le contenu
                est défini par filtrage du contenu d'une autre liste
                selon un principe analogue à celui de la définition
                par compréhension de la théorie des ensembles.
            </blockquote>
            <span class="sign">Wikipedia</span>
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
even_squares = [n ** 2 for n in range(20) if n % 2 == 0]
        </code></pre>
        <p>
            Le carré des nombres de 0 à 20 qui sont pairs.
        </p>
      </section>
      <section>
        <h2>Savoir enchainer</h2>
        <pre><code class="python">
evens = (n for n in range(20) if n % 2 == 0)
even_squares = [n**2 for n in evens]
        </code></pre>
      </section>
    </section>

<!--
    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            s = 'The - pythonic - and - elegant - way'
            result = ""
            for c in s:
              if c == ' ':
                pass  # skip
              elif c == '-':
                result += ' '
              else:
                result += c
        </code></pre>
      </section>
      <section>
        <h2>Se montrer <em>Compréhensif</em></h2>
        <p>
            Pour une itération simple on peut utiliser les <em>list comprehension</em>.
        </p>
        <p>
            <blockquote>
                la syntaxe de certains langages de programmation permet de définir
                des listes en compréhension,
                c'est-à-dire des listes dont le contenu
                est défini par filtrage du contenu d'une autre liste
                selon un principe analogue à celui de la définition
                par compréhension de la théorie des ensembles.
            </blockquote>
            <span class="sign">Wikipedia</span>
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            s = 'The - pythonic - and - elegant - way'
            result = ''.join(c if c != '-' else ' ' for c in s if c != ' ')
        </code></pre>
        <p>
            Ma nouvelle chaine est composé des éléments de ma chaine
            qui ne sont pas des espaces, en remplaçant les - par des espaces.
        </p>
      </section>
      <section>
        <h2>Savoir enchainer</h2>
        <pre><code class="python">
            s = 'The - pythonic - and - elegant - way'
            no_space = (c for c in s if c != ' ')
            result = ''.join(c if c != '-' else ' ' for c in no_space)
        </code></pre>
      </section>
    </section>
-->

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
f = open('path/to/file', 'w')
# lot of maybe failing processing here
f.write('Coucou')
f.close()
        </code></pre>
      </section>
      <section>
        <h2>Fiché !</h2>
        <p>
            Les <code>ContextManager</code> sont tes amis.
            Aussi toujours utiliser <code>open</code> avec <code>with</code>.
        </p>
        <p>
            L'assurance d'un fichier bien fermé !
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
with open('path/to/file', 'w') as f:
    f.write("I feel so smart")
        </code></pre>
      </section>
      <section>
        <h2>And more !</h2>
        <pre><code class="python">
import tempfile
with tempfile.NamedTemporaryFile() as f:
    f.write("This message will auto-destruct")
        </code></pre>
      </section>
    </section>


    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
# sorting on values
l = [(v, k) for k, v in my_dict.items()]
l.sort()
l = [(k, v) for k, v in l]
        </code></pre>
      </section>
      <section>
        <h2>Ne le traitez pas de la sorte !</h2>
        <p>
          <code>sort</code> et <code>sorted</code> acceptent
          le paramềtre <code>key</code> ou <code>cmp</code>.
        </p>
        <p>
          Ça fonctionne bien avec lambda, mais également une fonction, hein !
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
# sorting on values
l = sorted(my_dict.items(), key=lambda e: e[1])
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
v = values.get(key, None)
w = v is not None and int(v) or v
        </code></pre>
      </section>
      <section>
        <h2>Les vieilles habitudes !</h2>
        <p>
          Pour éviter ce design pattern,
          les
          <a href="https://docs.python.org/3/reference/expressions.html#conditional-expressions">
            expressions conditionnelles
          </a> ont été ajoutées en Python 2.5
        </p>
        <p>
          Ne pas en abuser ! (KISS)
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
v = values.get(key, None)
w = int(v) if v is not None else v
        </code></pre>
      </section>
    </section>

   <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
for i in range(len(my_list)):
    elt = my_list[i]
    print(i, ': ', elt)
        </code></pre>
      </section>
      <section>
        <h2>Un couple sur qui compter</h2>
        <p>
          <code>enumerate</code> renvoie successivement les couples index et élément
          d'un itérable.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
for i, elt in enumerate(my_list):
    print(i, ': ', elt)
        </code></pre>
      </section>
      <section>
        <h2>Bonus...</h2>
        <p>On peut aligner nos indexes en utilisant les options de <code>%d</code></p>
        <pre><code class="python">
print('% 5d: %s' % (i, elt))
        </code></pre>
      </section>
    </section>

   <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            # making an index of text
            index = {}
            for token in text.split():
                letter = token[0]
                if letter not in index:
                    index[letter] = []
                index[letter].append(token)
        </code></pre>
      </section>
      <section>
        <h2>Impression de déjà vu…</h2>
        <p>
          <code>setdefault</code> permet d'obtenir un élément d'un dictionnaire
          ou à défaut de mettre une nouvelle valeur dans le dictionnaire
          qui est ensuite retournée.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            # making an index of text
            index = {}
            for token in text.split():
                values = index.setdefault(letter, [])
                values.append(token)
        </code></pre>
      </section>
    </section>


    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
import random

class ListGenerator(object):
    def __init__(self, len):
        self.len = len

    def generate(self):
        return [random.random() for i in range(self.len)]

generator = ListGenerator(len=4)
generator.generate()            
        </code></pre>
      </section>
      <section>
        <h2>__call__ of ’</h2>
        <p>
            Une instance d'objet qui possède une méthode <code>__call__</code>
            peut être appelé comme une fonction.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
import random

class ListGenerator(object):
    def __init__(self, len):
        self.len = len

    def __call__(self):
        return [random.random() for i in range(self.len)]

generator = ListGenerator(len=4)
generator()
        </code></pre>
      </section>
    </section>


    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
def all_factorials(n):
    acc = 1
    results = []
    for i in range(1, n):
        acc = acc * i
        results.append(acc)
    return results

for i in all_factorials(10):
    print(i)
        </code></pre>
      </section>
      <section>
        <h2>Production en flux tendu</h2>
        <p>
            Une fonction contentant l'instruction <code>yield</code>
            est un générateur sur lequel on peut itérer.
        </p>
        <p>
            Lorsque l'on demande le nombre suivant,
            la fonction reprend là où elle s'était arrété.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
def all_factorials(n):
    acc = 1
    for i in range(1, n):
        acc = acc * i
        yield acc

for i in all_factorials(10):
    print(i)
        </code></pre>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
def all_factorials(n):
    acc = 1
    for i in range(1, n):
        acc = acc * i
        yield acc

def sqrt(numbers):
    for n in numbers:
        yield n**0.5

for i in sqrt(all_factorials(10)):
    print(i)
        </code></pre>
      </section>
    </section>

   <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
class Temperature(object):

    def __init__(self, celsius):
        self.celsius = celsius

    def get_celsius(self):
        return self.celsius

    def set_celsius(self, v):
        self.celsius = v

    def get_farenheit(self):
        return self.celsius * 1.8 + 32

    def set_farefheit(self, v):
        self.celsius = (v - 32) / 1.8

t = Temperature(30)
t.get_celsius() # 30
t.set_celsius(3) # chilling
t.get_farenheit()  # 37.4
t.set_farenheit(32)  # celsius is now 0.0
        </code></pre>
      </section>
      <section>
        <h2>La tribu d'Ynamic !</h2>
        <p>
          En python on peut définir des attributs de manière dynamique
          via le décorateur <code>property</code>.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
class Temperature(object):

    def __init__(self, celsius):
        self.celsius = float(celsius)

    @property
    def farenheit(self):
        return self.celsius * 1.8 + 32

    @farenheit.setter
    def farenheit(self, v):
        self.celsius = (v - 32) / 1.8

t = Temperature(30)
t.celsius # 30
t.celsius = 3 # chilling
t.farenheit  # 37.4
t.farenheit = 32  # celsius is now 0.0
        </code></pre>
      </section>
    </section>


   <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
class ArithTemperature(Temperature):

    def add(self, t):
        return ArithTemperature(self.celsius + t.celsius)

    def substract(self, t):
        return ArithTemperature(self.celsius - t.celsius)

    def is_zero(self):
        return self.celsius == - 273.15

t1 = ArithTemperature(30)
t2 = ArithTemperature(22)
t = t1.add(t2)
print(t.celsius) # 52
t = t1.substract(t2)
print(t.celsius) # 8
t.is_zero() # False
        </code></pre>
      </section>
      <section>
        <h2>Opérations en surcharge (non pondérale)</h2>
        <p>
          En python on peut surcharger les opérateurs.
          Dès que ça a du sens, il ne faut pas hésiter !
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
class ArithTemperature(Temperature):

    def __add__(self, t):
        return ArithTemperature(self.celsius + t.celsius)

    def __sub__(self, t):
        return ArithTemperature(self.celsius - t.celsius)

    def __nonzero__(self):
        return self.celsius != - 273.15

    def __str__(self):
        return "%d°" % self.celsius

t1 = ArithTemperature(30)
t2 = ArithTemperature(22)
print(t1 + t2) # 52°
t = t1 - t2
print(t) # 8°
bool(t) # True
        </code></pre>
      </section>
      <section>
        <h2>Un monde d'opérations</h2>
        <p>
          Python permet d'émuler les types arithmétiques mais aussi
          les listes (découpage, accès a un élément, etc…)
          les fonctions (voir <code>__call__</code>)
          <a href="https://docs.python.org/2/reference/datamodel.html#special-method-names">
              et plein d'autres choses
          </a>
        </p>
      </section>
    </section>


    <section>
        <h2>Pour vos longues soirées d'hivers !</h2>
        <p>
            <a href="https://docs.python.org/3/reference/datamodel.html#special-method-names">Special method names</a> −
            <a href="https://docs.python.org/3/reference/compound_stmts.html#the-with-statement">The with statement</a>
        </p>
        <p>
            <a href="https://docs.python.org/3/library/functions.html">Builtin functions</a> −
            <a href="https://docs.python.org/3/library/stdtypes.html">Builtin types</a> −
            <a href="https://docs.python.org/3/library/string.html">string</a> −
            <a href="https://docs.python.org/3/library/re.html">re</a> −
            <a href="https://docs.python.org/3/library/datetime.html">datetime</a> −
            <a href="https://docs.python.org/3/library/collections.html">collections</a> −
            <a href="https://docs.python.org/3/library/enum.html">enum</a> −
            <a href="https://docs.python.org/3/library/itertools.html">itertools</a> −
            <a href="https://docs.python.org/3/library/functools.html">functools</a> −
            <a href="https://docs.python.org/3/library/os.path.html">os.path</a> −
            <a href="https://docs.python.org/3/library/shutil.html">shutil</a> −
            <a href="https://docs.python.org/3/library/argparse.html">argparse</a> −
            <a href="https://docs.python.org/3/library/logging.html">logging</a> −
            <a href="https://docs.python.org/3/library/importlib.html">importlib</a>
        </p>
        <p>
            <a href="https://docs.python.org/3/tutorial/">The python tutorial</a> −
            <a href="http://fr.assimil.com/methodes/le-neerlandais">Apprendre la néerlandais</a>
        </p>
    </section>

    <section>
        <h2>Merci de votre attention</h2>
        <p>
            Des questions ?
        </p>
    </section>


</div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>

    // Full list of configuration options available here:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Parallax scrolling
        // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
        // parallaxBackgroundSize: '2100px 900px',

        // Optional libraries used to extend on reveal.js
        dependencies: [
            { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
            { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
            { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
            { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
    });

</script>

</body>
</html>
