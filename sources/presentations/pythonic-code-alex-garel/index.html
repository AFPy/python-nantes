<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Écrire du code vraiment Pythonic !</title>

		<meta name="description" content="">
		<meta name="author" content="Alex Garel">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- Personal CSS -->
		<link rel="stylesheet" href="pres.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

<body>

<div class="reveal">

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">
    <section>
        <h1>Écrire du code vraiment Pythonic !</h1>
        <div class="fragment roll-in" data-fragment-index="1">
        <pre class="fragment shrink" data-fragment-index="2"><code class="python">
          &gt;&gt;&gt;&nbsp;import this
        </code></pre>
        </div>
        
        <pre class="fragment roll-in" data-fragment-index="2"><code class="python">
          Readability counts.
        </code></pre>
        <p>
            Par Alex Garel pour le Nantes Python Meetup #4
        </p>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            if this == other:
              return True
            else:
              return False
        </code></pre>
      </section>
      <section>
        <h2>Le vrai de vrai</h2>
        <p>
            La valeur du test est un booléen, il suffit de le renvoyer !
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            return this == other
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            a,b=23, 12


            for x  in range( 12 ) :
                process(x,a = "This is a bit long",
                    b = i)
            value = theBigObject_on_steroids.theProperty_with_a_long_name.Thelong_method(another_long_indentifier*New_object()).am_i_still_in_screen()
        </code></pre>
      </section>
      <section>
        <h2>Pep8</h2>
        <p>
            Un standard qui veut aider à la lecture du code entre développeurs.
            <a href="https://flake8.readthedocs.org">flake8</a> est ton ami.
        </p>
        <p>
            Si un communauté à d'autres normes,
            suivez les normes de cette communauté dans vos contributions.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            a, b = 23, 12

            for x in range(12):
                process(
                    x, a="This is a bit long", b=i)

            value = (the_big_object_on_steroids
                .the_property_with_a_long_name
                .the_long_method(
                    another_long_indentifier * NewObject())
                .am_i_still_in_screen())
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            if len(my_list) == 0:
              print("Oh Gosh, this is empty !")
            if len(your_list) > 0:
              print("Gimme some !")
        </code></pre>
      </section>
      <section>
        <h2>Le vrai du faux</h2>
        <p>
            Pas besoin de tester la longueur pour savoir q'une liste est vide.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            if not my_list:
              print("Oh Gosh, this is empty !")
            if your_list:
              print("Gimme some !")
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            def is_empty(a_list):
                return a_list
        </code></pre>
      </section>
      <section>
        <h2>Le vrai du faux</h2>
        <p>
            Si une fonction doit renvoyer un booléen, faite le,
            <code>bool</code> est là pour ça
        </p>
        <p>
            <blockquote>
                Soyez tolérant dans ce que vous acceptez, exigeant dans ce que vous donnez.
            </blockquote>
            -- d’après <a href="http://www.postel.org/postel.html">Jon Postel</a>
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            def is_empty(a_list):
                return bool(a_list)
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            # adding value to a query string
            # we need to escape the '&amp;'
            query_string_list = []
            if isinstance(value, str):
                try:
                    param_value = value.replace('&', '%26')
                except AttributeError:
                    param_value = value
                query_string_list.append('%s=%s' % (param, param_value))
            elif isinstance(value, list):
                for subvalue in value:
                    try:
                        param_value = subvalue.replace('&', '%26')
                    except AttributeError:
                        param_value = subvalue
                    query_string_list.append('%s=%s' % (param, param_value))
        </code></pre>
      </section>
      <section>
        <h2>Je ne veux voir qu'une tête !</h2>
        <p>
            Avant de traiter, normaliser les entrées évite de dupliquer le code,
            et permet de simplifier sa compréhension.
        </p>
        <p>
        <blockquote>
            Special cases aren't special enough <br>to break the rules
        </blockquote>
        -- zen of python #8
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            # adding value to a query string
            # we need to escape the '&amp;'
            query_string_list = []
            for param, value in params.items():
                if not isinstance(value, list):
                    value = [value]
                for subvalue in value:
                    param_value = str(subvalue).replace('&', '%26')
                    query_string_list.append('%s=%s' % (param, param_value))
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            # swap x and y
            temp = y
            y = x
            x = y
        </code></pre>
      </section>
      <section>
        <h2>Échange rapide</h2>
        <p>
            En python on peut directement affecter une valeur a un tuple.
            On appelle ça <em>unpacking</em> (dépaquetage ?)".
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            x, y = y, x
        </code></pre>
      </section>
            <section>
        <h2>En profondeur</h2>
        <pre><code class="python">
            circle = (2.0, (1.0, 1.0))
            r, (x, y) = circle
        </code></pre>
        <pre><code class="python">
            import math

            def distance((x0, y0), (x1, y1)):
                return math.sqrt((x1 - x0)**2 + (y1 - y0)**2)

            point1 = (0.0, 0.0)
            point2 = (1.0, 1.0)
            distance(point1, point2)
        </code></pre>
        <p>Pour les cas simples, hein !
        </p>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            even_squares = []
            for n in range(20):
              if n % 2 == 0:
                  even_squares.append(n ** 2)
        </code></pre>
      </section>
      <section>
        <h2>Se montrer <em>Compréhensif</em></h2>
        <p>
            Pour une itération simple on peut utiliser les <em>list comprehension</em>.
        </p>
        <p>
            <blockquote>
                la syntaxe de certains langages de programmation permet de définir
                des listes en compréhension,
                c'est-à-dire des listes dont le contenu
                est défini par filtrage du contenu d'une autre liste
                selon un principe analogue à celui de la définition
                par compréhension de la théorie des ensembles.
            </blockquote>
            -- Wikipedia
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            even_squares = [n ** 2 for n in range(20) if n % 2 == 0]
        </code></pre>
        <p>
            Le carré des nombres de 0 à 20 qui sont pairs.
        </p>
      </section>
      <section>
        <h2>Savoir enchainer</h2>
        <pre><code class="python">
            evens = (n for n in range(20) if n % 2 == 0)
            even_squares = [n**2 for n in evens]
        </code></pre>
      </section>
    </section>

<!--
    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            s = 'The - pythonic - and - elegant - way'
            result = ""
            for c in s:
              if c == ' ':
                pass  # skip
              elif c == '-':
                result += ' '
              else:
                result += c
        </code></pre>
      </section>
      <section>
        <h2>Se montrer <em>Compréhensif</em></h2>
        <p>
            Pour une itération simple on peut utiliser les <em>list comprehension</em>.
        </p>
        <p>
            <blockquote>
                la syntaxe de certains langages de programmation permet de définir
                des listes en compréhension,
                c'est-à-dire des listes dont le contenu
                est défini par filtrage du contenu d'une autre liste
                selon un principe analogue à celui de la définition
                par compréhension de la théorie des ensembles.
            </blockquote>
            -- Wikipedia
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            s = 'The - pythonic - and - elegant - way'
            result = ''.join(c if c != '-' else ' ' for c in s if c != ' ')
        </code></pre>
        <p>
            Ma nouvelle chaine est composé des éléments de ma chaine
            qui ne sont pas des espaces, en remplaçant les - par des espaces.
        </p>
      </section>
      <section>
        <h2>Savoir enchainer</h2>
        <pre><code class="python">
            s = 'The - pythonic - and - elegant - way'
            no_space = (c for c in s if c != ' ')
            result = ''.join(c if c != '-' else ' ' for c in no_space)
        </code></pre>
      </section>
    </section>
-->

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            f = open('path/to/file', 'w')
            # lot of maybe failing processing here
            f.write('Coucou')
            f.close()
        </code></pre>
      </section>
      <section>
        <h2>Fiché !</h2>
        <p>
            Les <code>ContextManager</code> sont tes amis.
            Aussi toujours utiliser <code>open</code> avec <code>with</code>.
        </p>
        <p>
            L'assurance d'un fichier bien fermé !
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            with open('path/to/file', 'w') as f:
                f.write("I feel so smart")
        </code></pre>
      </section>
      <section>
        <h2>And more !</h2>
        <pre><code class="python">
            import tempfile
            with tempfile.NamedTemporaryFile() as f:
                f.write("This message will auto-destruct")
        </code></pre>
      </section>
    </section>


    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            # sorting on values
            l = [(v, k) for k, v in my_dict.items()]
            l.sort()
            l = [(k, v) for k, v in l]
        </code></pre>
      </section>
      <section>
        <h2>Ne le traitez pas de la sorte !</h2>
        <p>
          <code>sort</code> et <code>sorted</code> acceptent
          le paramềtre <code>key</code> ou <code>cmp</code>.
        </p>
        <p>
          Ça fonctionne bien avec lambda, mais également une fonction, hein !
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            # sorting on values
            l = sorted(my_dict.items(), key=lambda e: e[1])
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            v = values.get(key, None)
            w = v is not None and int(v) or v
        </code></pre>
      </section>
      <section>
        <h2>Les vieilles habitudes !</h2>
        <p>
          Pour éviter ce design pattern,
          les
          <a href="https://docs.python.org/3/reference/expressions.html#conditional-expressions">
            expressions conditionnelles
          </a> ont été ajoutées en Python 2.5
        </p>
        <p>
          Ne pas en abuser ! (KISS)
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            v = values.get(key, None)
            w = int(v) if v is not None else v
        </code></pre>
      </section>
    </section>

   <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            for i in range(len(my_list)):
                elt = my_list[i]
                print(i, ': ', elt)
        </code></pre>
      </section>
      <section>
        <h2>Un couple sur qui compter</h2>
        <p>
          <code>enumerate</code> renvoie successivement les couples index et élément
          d'un itérable.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            for i, elt in enumerate(my_list):
                print(i, ': ', elt)
        </code></pre>
      </section>
      <section>
        <h2>Bonus...</h2>
        <p>On peut aligner nos indexes en utilisant les options de <code>%d</code></p>
        <pre><code class="python">
            print('% 5d: %s' % (i, elt))
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            import random

            class ListGenerator(object):
                def __init__(self, len):
                    self.len = len

                def generate():
                    return [random.random() for i in range(self.len)]

            generator = ListGenerator(len=4)
            return generator.generate()            
        </code></pre>
      </section>
      <section>
        <h2>__call__ of ’</h2>
        <p>
            Une instance d'objet qui possède une méthode <code>__call__</code>
            peut être appelé comme une fonction.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            import random

            class ListGenerator(object):
                def __init__(self, len):
                    self.len = len

                def __call__():
                    return [random.random() for i in range(self.len)]

            generator = ListGenerator(len=4)
            return generator()
        </code></pre>
      </section>
    </section>

   <section>
      <section>
        <h2>Bouh !</h2>
        <pre><code class="python">
            # making an index of text
            index = {}
            for token in text.split():
                letter = token[0]
                if letter not in index:
                    index[letter] = []
                index[letter].append(token)
        </code></pre>
      </section>
      <section>
        <h2>Impression de déjà vu…</h2>
        <p>
          <code>setdefault</code> permet d'obtenir un élément d'un dictionnaire
          ou a défaut de mettre une nouvelle valeur dans le dictionnaire
          qui est ensuite retournée.
        </p>
      </section>
      <section>
        <h2>Yeah !</h2>
        <pre><code class="python">
            # making an index of text
            index = {}
            for token in text.split():
                values = index.setdefault(letter, [])
                values.append(token)
        </code></pre>
      </section>
    </section>

    <section>
        <h2>Merci de votre attention</h2>
        <p>
            Des questions ?
        </p>
    </section>


</div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>

    // Full list of configuration options available here:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Parallax scrolling
        // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
        // parallaxBackgroundSize: '2100px 900px',

        // Optional libraries used to extend on reveal.js
        dependencies: [
            { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
            { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
            { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
            { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
    });

</script>

</body>
</html>
